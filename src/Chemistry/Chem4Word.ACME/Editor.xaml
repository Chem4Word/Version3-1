<UserControl
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:graphics="clr-namespace:Chem4Word.ACME.Graphics"
    xmlns:acme="clr-namespace:Chem4Word.ACME"
    x:Class="Chem4Word.ACME.Editor"
    d:DesignHeight="300"
    mc:Ignorable="d"
    x:Name="AcmeControl" Loaded="ACMEControl_Loaded">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Resources/Brushes.xaml" />
                <ResourceDictionary Source="Resources/ControlStyles.xaml" />
                <ResourceDictionary Source="Resources/ACMEResources.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>

        <!-- Atom Colours -->
    </UserControl.Resources>

    <DockPanel LastChildFill="True" >

        <ToolBarTray DockPanel.Dock="Top" >
            <ToolBarTray.Resources>
                <Style TargetType="{x:Type Popup}">
                    <Setter Property="StaysOpen" Value="False" />
                    <EventSetter Event="Button.Click" Handler="EventSetter_OnHandler"></EventSetter>
                </Style>
                <Style TargetType="{x:Type Border}">
                    <Setter Property="Background" Value="{StaticResource {x:Static SystemColors.MenuBrushKey}}" />
                    <Setter Property="BorderThickness" Value="1" />
                    <Setter Property="Padding" Value="2" />
                </Style>
                <Style TargetType="{x:Type RadioButton}" x:Key="ToolbarButtonStyle">
                    <Setter Property="HorizontalAlignment" Value="Stretch" />
                    <Setter Property="BorderBrush" Value="Transparent" />
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="HorizontalContentAlignment" Value="Left" />
                    <Setter Property="Height" Value="30"/>
                    <Setter Property="Width" Value="30"/>
                    <Setter Property="FontSize" Value="20"/>
                    <Setter Property="Margin" Value="0"/>
                    <Setter Property="Padding" Value="0"/>
                </Style>
            </ToolBarTray.Resources>
            <ToolBar x:Name="DrawingToolbar" BandIndex="0" >
                <ComboBox
					x:Name="AtomCombo"
					Width="48"
                    FontFamily="Arial"
					FontWeight="DemiBold" FontSize="16"
                    ToolTip="Current atom type"
                    ItemsSource="{StaticResource AtomItems}"
                    SelectedIndex="0"
                    SelectedValue="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}, Path=SelectedAtomOption}" SelectionChanged="AtomCombo_SelectionChanged">
                </ComboBox>
                <ComboBox
					x:Name="BondCombo"
					Width="48" Height="25"
                    ToolTip="Current bond type"
                    ItemsSource="{StaticResource BondItems}"
                    SelectedIndex="0"
                    SelectedValue="{Binding  RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}} , Path=SelectedBondOption}">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <Path Style="{Binding Path=DisplayStyle}"/>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
            </ToolBar>
            <ToolBar x:Name="ActionToolBar" Height="40" BandIndex="1">
                <!-- see https://dvoituron.com/2011/01/06/toolbar-dropdownbutton-in-wpf/
                also https://materialdesignicons.com/ for icon paths -->


                <RadioButton ToolTip="Select" Style="{StaticResource ToolbarButtonStyle}"  x:Name="SelectionButton">
                    <Viewbox Stretch="Uniform" Height="25" Width="25">
                        <Path Width="12.3333" Height="20"  Stretch="Fill" Fill="#FF000000" Data="F1 M 28.5,17.4167L 53.8333,44.3333L 43.5417,44.3333L 49.875,55.4167L 43.5417,58.5833L 37.2083,47.5L 28.5,55.4167L 28.5,17.4167 Z "/>

                    </Viewbox>

                </RadioButton>

                <RadioButton ToolTip="Draw" Style="{StaticResource ToolbarButtonStyle}" x:Name="DrawButton" >
                    <Viewbox Stretch="UniformToFill" Height="24" Width="24">
                        <Path Width="50.4259" Height="50.4259" Stretch="Fill" Fill="#FF000000" Data="F1 M 21.5367,46.0076L 19,57L 29.3932,54.6016C 28.0768,50.6411 25.8696,47.0904 21.5367,46.0076 Z M 39,53L 69.4259,22.5741C 67.0871,17.8183 63.7005,13.6708 59.5673,10.4327L 31,39L 31,45L 39,45L 39,53 Z M 29,38L 57.8385,9.1615C 56.438,8.19625 54.9638,7.33038 53.4259,6.57407L 24,36L 24,38L 29,38 Z "/>
                    </Viewbox>
                </RadioButton>

                <RadioButton Name="RingButton"  ToolTip="Insert a ring">
                    <StackPanel Orientation="Horizontal">
                        <Path Style="{StaticResource BenzeneStyle}" Name="RingButtonPath"></Path>
                    </StackPanel>
                </RadioButton>
                <Button Name="RingDropdownButton" Width="10"  Click="RingDropdown_OnClick" ToolTip="Select Ring">
                    <Viewbox Stretch="Uniform">
                        <Path Data="M -7.5,0 l 15,0 l -7.5, 7.5 Z" Fill="Black"/>
                    </Viewbox>
                </Button>
                <!-- Print Toggle Button Popup -->
                <Popup x:Name="RingPopup" PlacementTarget="{Binding ElementName=RingButton}">
                    <Border>
                        <WrapPanel Width="70">
                            <!-- Print to local -->
                            <Button ToolTip="Benzene" Click="RingSelButton_OnClick">
                                <Path Style="{StaticResource BenzeneStyle}"/>
                            </Button>
                            <!-- Print to network -->
                            <Button ToolTip="Cyclochexane"  Click="RingSelButton_OnClick">
                                <Path  Style="{StaticResource CyclohexStyle}"/>
                            </Button>
                            <Button ToolTip="Cyclopentane"  Click="RingSelButton_OnClick">
                                <Path Style="{StaticResource CyclopentStyle}"  />
                            </Button>
                            <Button ToolTip="Cyclopentadiene" Click="RingSelButton_OnClick">
                                <Path Style="{StaticResource CyclopentadieneStyle}"  />
                            </Button>
                        </WrapPanel>
                    </Border>
                </Popup>
                <RadioButton Style="{StaticResource ToolbarButtonStyle}" x:Name="ChainButton">
                    <Path Style="{StaticResource ChainStyle}">
                        <Path.LayoutTransform>
                            <RotateTransform Angle="180"></RotateTransform>
                        </Path.LayoutTransform>
                    </Path>
                </RadioButton>

                <RadioButton Style="{StaticResource ToolbarButtonStyle}" x:Name="ReactionButton">
                    <Viewbox Stretch="Uniform">
                        <StackPanel>
                            <TextBlock FontFamily="Arial"  HorizontalAlignment="Center">NH<Run BaselineAlignment="Subscript" FontSize="12">3</Run></TextBlock>

                            <graphics:ArrowBase
                                StartPoint="0,5" 
                                EndPoint="45,5" 
                                Stroke="Black" 
                                Fill="Black" 
                                IsArrowClosed="True" 
                                ArrowHeadLength="10" 
                                HeadAngle="35"/>

                            <TextBlock FontFamily="Arial"  HorizontalAlignment="Center">H<Run BaselineAlignment="Subscript" FontSize="12">2</Run>O</TextBlock>
                        </StackPanel>
                    </Viewbox>
                </RadioButton>

                <RadioButton ToolTip="Delete" Style="{StaticResource ToolbarButtonStyle}"  FontSize="18"  x:Name="Button" >
                    <Viewbox Stretch="UniformToFill" Height="24"  Width="24">
                        <Path Fill="#FF000000" Data="M16.24,3.56L21.19,8.5C21.97,9.29 21.97,10.55 21.19,11.34L12,20.53C10.44,22.09 7.91,22.09 6.34,20.53L2.81,17C2.03,16.21 2.03,14.95 2.81,14.16L13.41,3.56C14.2,2.78 15.46,2.78 16.24,3.56M4.22,15.58L7.76,19.11C8.54,19.9 9.8,19.9 10.59,19.11L14.12,15.58L9.17,10.63L4.22,15.58Z" />
                    </Viewbox>
                </RadioButton>
            </ToolBar>
            <ToolBar x:Name="EditToolbar" Height="40" BandIndex="2">
                <ToolBar.RenderTransform>
                    <TransformGroup>
                        <ScaleTransform/>
                        <SkewTransform AngleY="0.988"/>
                        <RotateTransform/>
                        <TranslateTransform Y="0.983"/>
                    </TransformGroup>
                </ToolBar.RenderTransform>
                
                <RadioButton Style="{StaticResource ToolbarButtonStyle}" x:Name="CutButton">
                    <Viewbox Stretch="UniformToFill" Height="24" Width="25">
                        <Path   Stretch="UniformToFill" Fill="#FF000000" Data="F1 M 26,42C 27.1737,42 28.2799,42.3095 29.2514,42.8564L 33.538,38.5699L 36.9626,42.1932L 32.4905,46.6858C 32.8191,47.5548 33,48.5048 33,49.5C 33,53.6421 29.866,57 26,57C 22.134,57 19,53.6421 19,49.5C 19,45.3579 22.134,42 26,42 Z M 26,45C 23.7908,45 22,47.0147 22,49.5C 22,51.9853 23.7908,54 26,54C 28.2091,54 30,51.9853 30,49.5C 30,47.0147 28.2091,45 26,45 Z M 50,42C 53.866,42 57,45.3579 57,49.5C 57,53.6421 53.866,57 50,57C 46.134,57 43,53.6421 43,49.5C 43,48.5055 43.1807,47.5562 43.5087,46.6877C 37.4037,40.5816 31.3813,34.5251 28.1357,30.1361C 24.7905,25.6125 24.3953,22.8602 24,20.1079L 46.7486,42.8564C 47.7201,42.3095 48.8263,42 50,42 Z M 50,45C 47.7908,45 46,47.0147 46,49.5C 46,51.9853 47.7908,54 50,54C 52.2091,54 54,51.9853 54,49.5C 54,47.0147 52.2091,45 50,45 Z M 47.8643,30.1361C 46.4839,32.0028 44.6012,34.1712 42.4235,36.5166L 41.9416,36.0347C 43.8801,33.9052 45.5581,31.9333 46.8205,30.213C 49.9109,26.0015 50.51,23.7154 50.8952,21.2126L 52,20.1079C 51.6047,22.8602 51.2095,25.6125 47.8643,30.1361 Z M 39.0074,33.1005L 50.2564,21.8515C 49.8163,23.9301 48.9562,26.0005 46.4256,29.4492C 45.0997,31.2561 43.5411,33.3404 41.5003,35.5935L 39.0074,33.1005 Z M 35.8034,42.4922L 35.3653,42.0251L 31.9263,45.5067C 32.0391,45.6984 32.1441,45.8961 32.2406,46.099L 35.8034,42.4922 Z "/>
                    </Viewbox>
                </RadioButton>
                <RadioButton Style="{StaticResource ToolbarButtonStyle}" x:Name="CopyButton">
                    <Viewbox Stretch="UniformToFill" Height="24" Width="22">
                        <Path Stretch="UniformToFill" Fill="#FF000000" Data="F1 M 27,20L 38.75,20L 37.75,19L 24,19L 24,50L 27,50L 27,20 Z M 46.25,20L 59,32.75L 59,59L 27,59L 27,54L 20,54L 20,15L 39.25,15L 44.25,20L 46.25,20 Z M 31,24L 31,55L 55,55L 55,37L 42,37L 42,24L 31,24 Z M 46,25.25L 46,33L 53.75,33L 46,25.25 Z "/>
                    </Viewbox>
                </RadioButton>
                <RadioButton Style="{StaticResource ToolbarButtonStyle}" x:Name="PasteButton">
                    <Viewbox Stretch="UniformToFill" Width="22" Height="26" >

                        <Path Stretch="UniformToFill" Fill="#FF000000" 
                                  Data="F1 M 34.0001,60C 32.3433,60 31.0001,58.6569 31.0001,57L 31.0001,54.0001L 23,54.0001C 21.3431,54.0001 
                                  20,52.6569 20,51.0001L 20,24.0001C 20,22.3432 21.3431,21.0001 23,21.0001L 26.5001,20.9999C 26.5001,20.9999 
                                  27.4999,20.8807 27.4999,19.5C 27.4999,18.1193 29.1191,17 30.4999,17L 38.4998,17.0001C 39.8798,17.0001 41.4988,18.6176 41.5,19.9979L 
                                  41.4998,19.5024C 41.5009,20.881 42.5,21 42.5,21L 46,21.0001C 47.6569,21.0001 49,22.3432 49,24.0001L 49,31L 56,38L 56.0001,57C 
                                  56.0001,58.6569 54.657,60 53.0001,60L 34.0001,60 Z M 33.9999,31.0001L 33.9999,57.0001L 53.0001,57L 53.0001,43L 42.0002,43L 42.0001,31L 33.9999,31.0001 Z
                                  M 53,40.0001L 45,32.0001L 45.0001,40L 53,40.0001 Z M 28.5,25L 40.5,25C 40.5,25 39.4998,23.8809 39.4998,22.5002C 39.4998,21.1194 
                                  38.3805,20.0002 36.9998,20.0002L 31.9998,20.0002C 30.6191,20.0002 29.4998,21.1194 29.4998,22.5002C 29.4998,23.8809 28.5,25 28.5,25 Z "/>
                    </Viewbox>
                </RadioButton>
            </ToolBar>
        </ToolBarTray>
        <Grid DockPanel.Dock="Top">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="207*"/>
                <ColumnDefinition Width="13*"/>
                <ColumnDefinition Width="215*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <ScrollViewer
				HorizontalScrollBarVisibility="Auto"
				VerticalScrollBarVisibility="Auto" Grid.Column="0" Grid.ColumnSpan="3">
                <acme:Display x:Name="DrawingArea" Width="2400" Height="1800"   Background="White" Loaded="DrawingArea_Loaded">
                    <acme:Display.LayoutTransform>
                        <ScaleTransform
							ScaleX="{Binding Value, ElementName=ScaleSlider}"
							ScaleY="{Binding Value, ElementName=ScaleSlider}" />
                    </acme:Display.LayoutTransform>
                </acme:Display>
            </ScrollViewer>
            <Slider x:Name="ScaleSlider" Grid.Column="3" Orientation="Vertical" Visibility="{Binding ElementName=AcmeControl, Path=SliderVisibility}"/>
        </Grid>
    </DockPanel>
</UserControl>